{% extends "index.html" %}
{% load static %} 
{% block head %}
<style>
  .modal-content{
    margin-left:50px;
 }
</style>
{% endblock %}
{% block heading %}
<span class="tab-title">
 <span class="px-1"> Teacher Master</span>
</span>
{% endblock %}
{% block body %}
    <div class="d-flex justify-content-end">
      {% comment %} <a data-bs-toggle="modal" data-bs-target="#uploadexcel" class="btn btn-primary mx-2">Upload Excel</a> {% endcomment %}
      <a href="/teacher_master/add_teacher"  class="btn btn-primary">Add Teacher</a>

    </div>

     
    {% comment %} <div id="uploadexcel" class="modal">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
  
          <div class="modal-body">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title fw-semibold mb-4">Upload Excel</h5>
              <div class="card">
                <div class="card-body">
                  <div class="file-upload-box text-center">
                    <div class="px-2">
                      <a class="btn btn-primary" title="download excel format" href="{% static 'Media/SampleExcels/teachermaster.xlsx'%}" download>Download Sample<i class="fa fa-download" aria-hidden="true"></i></a>
                    </div>
                    <div class="file-upload-btn">
                      <input type="file" name="myfile" id="myfile" hidden="hidden" />
                      <p id="custom-text">No file chosen, yet.</p>
                      <button type="button" id="fileName" class="btn-primary btn excel-btn-info">Upload Excel File</button>
                     <div class="mt-3">
                      <a class="btn btn-primary" onclick="filevalidation();">submit</a>
                     </div>
                    
                   </div>
                  
                   </div>
                </div>
              </div>
            </div>
          </div>
          </div>
        </div>
      </div>
    </div> {% endcomment %}


  <div class="row">
    <table id="example" class="table table-striped table-bordered" style="width:100%">
      <thead>
          <tr>
              <th>Sr No</th>
              <th>Teacher Name</th>
              <th>Email</th>
              <th>Contact</th>
              <th>Address</th>

              <th>Action</th>
          </tr>
      </thead>
      <tbody>

        {% for i in teachers %}
          <tr>
              <td>{{forloop.counter}}</td>
              <td>{{i.Username}}</td>
              
              <td>{{i.email}}</td>
              <td>{{i.mobileNumber}}</td>
              <td>{{i.Address}}</td>

              <td>
                <a data-bs-toggle="tooltip" title="Edit Teacher" href="/teacher_master/edit_teacher/{{i.id}}"><i class="fa-solid fa-pen-to-square mx-1"></i></a>
                <a data-bs-toggle="tooltip" title="Delete Teacher" onclick="delete_teacher('{{i.id}}')"><i class="fa-solid fa-trash-can text-danger mx-1"></i></a>
              </td>
            


          </tr>
          {% endfor %}

      </tbody>

  </table>
  </div> 
  
  
{% endblock %}

{% block script %}
<script>
  $( document ).ready(function() {
    new DataTable('#example');  
  });  

  function delete_teacher(id){
    Swal.fire({
      title: "Are you sure?",
      text: "You won't be able to revert this!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Yes, delete it!"
    }).then((result) => {
      if (result.isConfirmed) {
        var fd = new FormData();    
        fd.append("id",id);
        fd.append("csrfmiddlewaretoken","{{csrf_token}}");
        $.ajax({
          type: "POST",
          url: frontend_url+"teacher_master/delete_teacher",
          data: fd,
          processData: false,
          contentType: false,
          
          success: function(response) {
            console.log("delete",response)
            if(response.response.n ==1){
              Swal.fire({
                text: response.response.msg,
                icon: 'success',
              }).then((result) => {
                window.location.href = "/teacher_master";
        
              });
            }else{
              Swal.fire({
                text: response.response.msg,
                icon: 'error',
              })
            }

      
          },
        });




      }
    });
     

  }

  //
{% comment %} const realFileBtn = document.getElementById("myfile");
const customBtn = document.getElementById("fileName");
const customTxt = document.getElementById("custom-text");

customBtn.addEventListener("click", function() {
  realFileBtn.click();
});

realFileBtn.addEventListener("change", function() {
  if (realFileBtn.value) {
    customTxt.innerHTML = realFileBtn.value.match(
      /[\/\\]([\w\d\s\.\-\(\)]+)$/
    )[1];
  } else {
    customTxt.innerHTML = "No file chosen, yet.";
  }
});

$('#myfile').bind('change', function () {
var filename = $("#myfile").val();
if (/^\s*$/.test(filename)) {
  $(".file-upload").removeClass('active');
  $("#noFile").text("No file chosen..."); 
}
else {
  $(".file-upload").addClass('active');
  $("#noFile").text(filename.replace("C:\\fakepath\\", "")); 
}
});

function filevalidation(){
debugger;
var file = $("#myfile")[0].files[0];
console.log("filefile",file)

if (file == "" || file == undefined) {
  event.preventDefault()
  Swal.fire({
              text: "choose file",
              icon: 'error',
            })
 
  return false;
}
else{
  t = 'Bearer {{token}}'
  var fd = new FormData();    
      fd.append("classfile",file);
     
      
      $.ajax({
        type: "POST",
        url: frontend_url+"api/TeacherMaster/teacherdatabyexcel",
        data: fd,
        headers:{'Authorization':t},
        processData: false,
        contentType: false,
        
        success: function(response) {
          if(response.response.n ==1){
            Swal.fire({
              text: response.response.msg,
              icon: 'success',
            }).then((result) => {
              window.location.href = "/teacher_master/";
      
            });
          }else{
            Swal.fire({
              text: response.response.msg,
              icon: 'error',
            })
          }

    
        },
      });

}
} {% endcomment %}
</script>
{% endblock %}