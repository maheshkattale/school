{% extends "index.html" %}
{% load static %} 
{% block head %}

<style>
    input[type="checkbox"] {
        cursor: pointer; /* Change cursor to pointer */
    }
</style>
{% endblock %}
{% block heading %}
<span class="tab-title">
    <span class="px-1"> Student ID Cards Ganerator</span>
</span>
{% endblock %}
{% block body %}
<div class="row justify-content-end">
  <div class="mb-3 col-lg-3">
      <label for="classid" class="form-label">Class</label>
      <select id="classid" class="form-select select2" aria-describedby="class_error">
        <option value="" selected>Please select class</option>
        {% for class in classes %}
          <option value="{{ class.id }}">{{ class.ClassName }} </option>
        {% endfor %}

      </select>
      <div id="class_error" class="form-text error_message"></div>
  </div>
     <div class="mb-3 col-lg-3">
      <label for="academic_year" class="form-label">Academic Year</label>
      <select id="academic_year" class="form-select select2" aria-describedby="academic_year_error">
        <option value="" selected>Please select academic year</option>
        {% for year in academic_years %}
          {% if year.isActive == True %}
            <option value="{{ year.id }}" selected>{{ year.startdate_month_yyyy }} to {{ year.enddate_month_yyyy }}</option>
          {% else %}
            <option value="{{ year.id }}">{{ year.startdate_month_yyyy }} to {{ year.enddate_month_yyyy }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <div id="academic_year_error" class="form-text error_message"></div>
    </div>



  <div class="mb-3 my-auto col-lg-3 d-flex justify-content-evenly">
    <a class="btn btn-primary" onclick="search_student();">Apply</a>
    <a class="btn btn-primary" onclick="generate_student_id_card();">Get ID Cards</a>
  </div>
</div>
  <div class="row">
    <table id="studentple" class="table table-striped table-bordered" style="width:100%">
      <thead>
          <tr>
              <th><input type="checkbox" name="" id="selectall" onclick="toggle(this);">  Sr No</th>
              <th>Name</th>
              <th>Class</th>
              <th>Action</th>
          </tr>
      </thead>
      <tbody id="table_body">

        {% for i in students %}
          <tr>
              <td> <input type="checkbox" name="student" id="" value="{{i.id}}"> {{forloop.counter }}  </td>
              <td>{{i.StudentName}}</td>
              <td>{{i.StudentClass}}</td>
      
 
              <td>
                <a data-bs-toggle="tooltip" title="Delete student" onclick="delete_student('{{i.StudentCode}}')"><i class="fa-solid fa-trash-can text-danger mx-1"></i></a>
              </td>
            


          </tr>
          {% endfor %}

      </tbody>

  </table>
  </div> 
  
<div id="idcarddiv" class="d-non">


    <table class="card">
        <tr>
          <td style="padding-right: 15px;">
            <div style="text-align: center;">
              <img src="{% static 'assets/images/logos/school_logo.JPG' %}" alt="" />
            </div>
          </td>
  
          <td style="    border-bottom: 2px solid #082e68;        ">
            <table style="text-align: center;">
              <tr>
                <td class="school_name">C.K.G High School</td>
              </tr>
  
              <tr>
                <td>(CBSC AFFILITED)</td>
              </tr>
  
              <tr>
                <td>Govali ,Ta.jaghadia , Dist.Bhuruch.</td>
              </tr>
  
              <tr>
                <td>PH.023-0345670276 , E-Mail : ckgschool@gmail.com</td>
              </tr>
            </table>
          </td>
        </tr>
  
        <tr>
          <td style="padding-right: 15px;">
            <img src="{% static 'assets/images/profile/profile.png' %}" alt="" width="140" />
          </td>
          <td>
            <table>
              <tr>
                <td class="card_heading">Name :</td>
                <td>Mahesh Kattale</td>
              </tr>
              <tr>
                <td class="card_heading">Class :</td>
                <td>VI</td>
              </tr>
              <tr>
                <td class="card_heading">DOB :</td>
                <td>21 April 2000</td>
              </tr>
              <tr>
                <td class="card_heading">Address :</td>
                <td>Soniupath jalna ,Pune Dist kolhaprty</td>
              </tr>
              <tr>
                <td class="card_heading">Phone :</td>
                <td>7766327669</td>
              </tr>
              <tr>
                <td class="card_heading">Mobile :</td>
                <td>7658893652</td>
              </tr>
            </table>
          </td>
        </tr>
  
      </table>

</div>

{% endblock %}

{% block script %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>




<script>
  $( document ).ready(function() {
        new DataTable('#studentple');  
  });  

  function delete_student(studentcode){
    Swal.fire({
      title: "Are you sure?",
      text: "You won't be able to revert this!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Yes, delete it!"
    }).then((result) => {
      if (result.isConfirmed) {
        var fd = new FormData();    
        fd.append("studentcode",studentcode);
        fd.append("csrfmiddlewaretoken","{{csrf_token}}");
        $.ajax({
          type: "POST",
          url: frontend_url+"student/delete_student",
          data: fd,
          processData: false,
          contentType: false,
          
          success: function(response) {
            console.log("delete",response)
            if(response.response.n ==1){
              Swal.fire({
                text: response.response.msg,
                icon: 'success',
              }).then((result) => {
                window.location.href = "/student/student_list";
        
              });
            }else{
              Swal.fire({
                text: response.response.msg,
                icon: 'error',
              })
            }

      
          },
        });




      }
    });
     

  }

</script>
<script>
  function search_student(){
    var classid = $('#classid').val();

    var yearid = $('#academic_year').val();

    var fd = new FormData();    
    fd.append("class",classid);
    fd.append("yearid",yearid);
    fd.append("csrfmiddlewaretoken","{{csrf_token}}");
    $.ajax({
      type: "POST",
      url: frontend_url+"student/student_list",
      data: fd,
      processData: false,
      contentType: false,
      
      success: function(response) {
        console.log("student_list",response)
        if(response.response.n ==1){
          var trhtml=''

          counter=1
          $.each(response.data,function(o,i){
            trhtml+=`
            <tr>
              <td><input type="checkbox" name="student" id="" value="`+i.id+`"> `+counter+`</td>
              <td>`+i.StudentName+`</td>
              <td>`+i.StudentClass+`</td>
              <td>
                <a data-bs-toggle="tooltip" title="Delete student" onclick="delete_student('`+i.StudentCode+`')"><i class="fa-solid fa-trash-can text-danger mx-1"></i></a>
              </td>
            
  
  
          </tr>
            
            `
            counter+=1

          });
          $('#table_body').html(trhtml)

          Swal.fire({
            text: response.response.msg,
            icon: 'success',
          })
        }else{
          Swal.fire({
            text: response.response.msg,
            icon: 'error',
          })
        }

  
      },
    });
  }
  function toggle(source) {
    var checkboxes = document.getElementsByName('student');
    for (var i = 0; i < checkboxes.length; i++) {
        checkboxes[i].checked = source.checked;
    }
}
function generate_student_id_card(){



    var selectedCheckboxes = document.querySelectorAll('input[name="student"]:checked');
    var selectedValues = [];
    selectedCheckboxes.forEach(function(checkbox) {
        selectedValues.push(checkbox.value);
    });
    console.log("Selected checkboxes: " + selectedValues);





    var classid = $('#classid').val();

    var yearid = $('#academic_year option:selected').text();

    var fd = new FormData();    
    fd.append("classid",classid);
    fd.append("year",yearid);
    fd.append("studentidlist",JSON.stringify(selectedValues));
    fd.append("csrfmiddlewaretoken","{{csrf_token}}");
    $.ajax({
      type: "POST",
      url: frontend_url+"student/student_id_cards",
      data: fd,
      processData: false,
      contentType: false,
      
      success: function(response) {
        console.log("student_card",response)
        if(response.response.n ==1){
          var trhtml=''
          var doc = new jsPDF();

          // Get the HTML content of the container div
          var containerContent = $('#idcarddiv').html();
  
          // Add the HTML content to the PDF
          doc.html(containerContent, {
              callback: function (doc) {
                  // Save the PDF with a specific name
                  doc.save('content.pdf');
              }
          });


          counter=1
          $.each(response.data,function(o,i){
            trhtml+=`

            `
            counter+=1

          });

          Swal.fire({
            text: response.response.msg,
            icon: 'success',
          })
        }else{
          Swal.fire({
            text: response.response.msg,
            icon: 'error',
          })
        }

  
      },
    });
}
</script>
{% endblock %}